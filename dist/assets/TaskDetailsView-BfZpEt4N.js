import{d as h,f as T,a as x,c as g,o as w,u as _,b,e as u,g as e,t as a,h as r,F as S,r as D,i as B,w as N,j as V,k as $,l as i,I as A}from"./index-DhoXhZvh.js";const C=h("taskStore",{state:()=>({tasks:[],taskLogs:{},selectedTask:null,isLoading:!1,error:null}),actions:{async loadTasks(){this.isLoading=!0,this.error=null;try{const t=await T();if(console.log("Данные от fetchTasks:",t),!Array.isArray(t))throw new Error("Сервер вернул данные, не являющиеся массивом");this.tasks=t.map(n=>({...n,created_at:n.created_at?new Date(n.created_at).toLocaleString():"Неизвестно"})),this.selectedTask=this.tasks.length>0?this.tasks[0]:null,console.log("Обработанные задачи:",this.tasks)}catch(t){t.message==="У вас нет задач. Вам нужно перейти в новую задачу и создать."?(console.warn(t.message),this.tasks=[]):(this.error=t.message||"Ошибка при загрузке задач",console.error("Ошибка при загрузке задач:",t))}finally{this.isLoading=!1}},selectTask(t){this.selectedTask=t,console.log("Выбрана задача:",t)},async loadTaskLogs(t){if(this.taskLogs[t]){console.log(`Логи для задачи ${t} уже загружены:`,this.taskLogs[t]);return}try{const n=await x(t);console.log(`Загруженные логи для задачи ${t}:`,n),this.taskLogs[t]=n}catch(n){console.error(`Ошибка при загрузке логов задачи ${t}:`,n),this.error=n.message||"Ошибка при загрузке логов"}}}}),E={key:1,class:"container mx-auto p-4"},F={class:"text-2xl font-bold mb-4"},M={key:0,class:"bg-white shadow-lg rounded-lg p-6"},R={key:0,class:"mt-4"},j={class:"list-disc pl-5"},q={key:1,class:"mt-4 text-slate-500"},O={key:1,class:"text-center"},U={key:2,class:"text-red-500"},G={__name:"TaskDetailsView",setup(t){const n=V(),o=C(),c=n.params.id,l=g(()=>o.selectedTask),p=g(()=>o.taskLogs),f=g(()=>o.isLoading),L=g(()=>o.error);return w(async()=>{try{o.tasks.length||await o.loadTasks();const d=o.tasks.find(s=>s.id===Number(c));d?(o.selectTask(d),await o.loadTaskLogs(c)):o.error=`Задача с ID ${c} не найдена`}catch(d){o.error=d.message||"Неизвестная ошибка при загрузке данных",console.error("Ошибка в onMounted:",d)}}),(d,s)=>{var m,v;const y=$("router-link");return _(o).isLoading?(i(),b(A,{key:0})):(i(),u("div",E,[e("h1",F,"Детали задачи: "+a(((m=l.value)==null?void 0:m.name)||"Загрузка..."),1),l.value?(i(),u("div",M,[e("p",null,[s[0]||(s[0]=e("strong",null,"ID:",-1)),r(" "+a(l.value.id),1)]),e("p",null,[s[1]||(s[1]=e("strong",null,"Название:",-1)),r(" "+a(l.value.name),1)]),e("p",null,[s[2]||(s[2]=e("strong",null,"URL:",-1)),r(" "+a(l.value.url),1)]),e("p",null,[s[3]||(s[3]=e("strong",null,"Содержимое:",-1)),r(" "+a(l.value.content),1)]),e("p",null,[s[4]||(s[4]=e("strong",null,"Интервал:",-1)),r(" "+a(l.value.interval),1)]),e("p",null,[s[5]||(s[5]=e("strong",null,"Частота:",-1)),r(" "+a(l.value.frequency||"Не указано"),1)]),e("p",null,[s[6]||(s[6]=e("strong",null,"Период:",-1)),r(" "+a(l.value.period||"Не указано"),1)]),e("p",null,[s[7]||(s[7]=e("strong",null,"Дата создания:",-1)),r(" "+a(l.value.created_at),1)]),s[9]||(s[9]=e("p",null,[e("strong",null,"Статус:"),r(),e("span",{class:"text-green-500"},"Ok")],-1)),(v=p.value[l.value.id])!=null&&v.length?(i(),u("div",R,[s[8]||(s[8]=e("h2",{class:"text-xl font-semibold"},"Логи задачи",-1)),e("ul",j,[(i(!0),u(S,null,D(p.value[l.value.id],k=>(i(),u("li",{key:k.id,class:"text-sm text-slate-600"},a(k.message)+" ("+a(new Date(k.created_at).toLocaleString())+") ",1))),128))])])):(i(),u("p",q,"Логов пока нет."))])):f.value?(i(),u("div",O,s[10]||(s[10]=[e("p",null,"Загрузка...",-1)]))):(i(),u("div",U,[e("p",null,"Задача не найдена или произошла ошибка: "+a(L.value),1)])),B(y,{to:"/",class:"mt-4 inline-block text-blue-600 hover:underline"},{default:N(()=>s[11]||(s[11]=[r(" Назад к списку задач ")])),_:1})]))}}};export{G as default};
