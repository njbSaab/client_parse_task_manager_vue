import{r as w,c as m,o as c,a as v,b as e,w as S,v as C,F as y,d as _,e as r,t as o,n as D,f as P,g as M,h as B,i as N,u as L,j as V,k as T,l as j,m as A,p as q,I as E}from"./index-9xhFwUc6.js";const F={key:0,class:"mt-4"},I={class:"relative flex flex-col w-full h-full text-gray-700 bg-white shadow-md rounded-lg bg-clip-border overflow-hidden overflow-x-auto"},R={class:"w-full text-left table-auto min-w-max"},U={class:"p-4 py-5"},z={class:"block font-semibold text-sm text-slate-800"},H={class:"p-4 py-5"},O={class:"text-sm text-slate-500"},G={class:"p-4 py-5"},J={class:"text-sm text-slate-500"},K={class:"flex justify-between items-center px-4 py-3"},Q={class:"text-sm text-slate-500"},W={class:"flex space-x-1"},X=["disabled"],Y=["onClick"],Z=["disabled"],ee={key:1,class:"mt-4 text-slate-500"},te={__name:"TaskLogsTable",props:{logs:{type:Array,required:!0,default:()=>[]}},setup(s){const a=s,l=w(1),u=w(5),n=m(()=>a.logs.length),b=m(()=>Math.ceil(n.value/u.value)),p=m(()=>(l.value-1)*u.value),g=m(()=>Math.min(p.value+u.value,n.value)),t=m(()=>a.logs.slice(p.value,g.value));function f(){l.value>1&&l.value--}function x(){l.value<b.value&&l.value++}function $(h){l.value=h}return(h,i)=>{var k;return(k=s.logs)!=null&&k.length?(c(),v("div",F,[i[4]||(i[4]=e("h2",{class:"text-xl font-semibold mb-3"},"Логи задачи",-1)),i[5]||(i[5]=e("label",{class:"mr-2 text-sm text-slate-500"},"Логов на странице:",-1)),S(e("select",{"onUpdate:modelValue":i[0]||(i[0]=d=>u.value=d),class:"border rounded p-1 text-sm bg-white mb-3"},i[1]||(i[1]=[e("option",{value:5},"5",-1),e("option",{value:10},"10",-1),e("option",{value:20},"20",-1)]),512),[[C,u.value]]),e("div",I,[e("table",R,[i[2]||(i[2]=e("thead",null,[e("tr",null,[e("th",{class:"p-4 border-b border-slate-200 bg-slate-50"},[e("p",{class:"text-sm font-normal leading-none text-slate-500"},"ID")]),e("th",{class:"p-4 border-b border-slate-200 bg-slate-50"},[e("p",{class:"text-sm font-normal leading-none text-slate-500"},"Сообщение")]),e("th",{class:"p-4 border-b border-slate-200 bg-slate-50"},[e("p",{class:"text-sm font-normal leading-none text-slate-500"},"Дата создания")])])],-1)),e("tbody",null,[(c(!0),v(y,null,_(t.value,d=>(c(),v("tr",{key:d.id,class:"hover:bg-slate-50 border-b border-slate-200"},[e("td",U,[e("p",z,o(d.id),1)]),e("td",H,[e("p",O,o(d.message),1)]),e("td",G,[e("p",J,o(new Date(d.created_at).toLocaleString()),1)])]))),128))])]),e("div",K,[e("div",Q,[i[3]||(i[3]=r(" Showing ")),e("b",null,o(p.value+1)+"-"+o(g.value),1),r(" of "+o(n.value),1)]),e("div",W,[e("button",{onClick:f,disabled:l.value===1,class:"px-3 py-1 min-w-9 min-h-9 text-sm font-normal text-slate-500 bg-white border border-slate-200 rounded hover:bg-slate-50 hover:border-slate-400 transition duration-200 ease disabled:opacity-50"}," Prev ",8,X),(c(!0),v(y,null,_(b.value,d=>(c(),v("button",{key:d,onClick:ie=>$(d),class:D(["px-3 py-1 min-w-9 min-h-9 text-sm font-normal rounded transition duration-200 ease",l.value===d?"text-white bg-slate-800 border border-slate-800 hover:bg-slate-600 hover:border-slate-600":"text-slate-500 bg-white border border-slate-200 hover:bg-slate-50 hover:border-slate-400"])},o(d),11,Y))),128)),e("button",{onClick:x,disabled:l.value===b.value,class:"px-3 py-1 min-w-9 min-h-9 text-sm font-normal text-slate-500 bg-white border border-slate-200 rounded hover:bg-slate-50 hover:border-slate-400 transition duration-200 ease disabled:opacity-50"}," Next ",8,Z)])])])])):(c(),v("p",ee,"Логов пока нет."))}}},se=P("taskStore",{state:()=>({tasks:[],taskLogs:{},selectedTask:null,isLoading:!1,error:null}),actions:{async loadTasks(){this.isLoading=!0,this.error=null;try{const s=await M();if(console.log("Данные от fetchTasks:",s),!Array.isArray(s))throw new Error("Сервер вернул данные, не являющиеся массивом");this.tasks=s.map(a=>({...a,created_at:a.created_at?new Date(a.created_at).toLocaleString():"Неизвестно"})),this.selectedTask=this.tasks.length>0?this.tasks[0]:null,console.log("Обработанные задачи:",this.tasks)}catch(s){s.message==="У вас нет задач. Вам нужно перейти в новую задачу и создать."?(console.warn(s.message),this.tasks=[]):(this.error=s.message||"Ошибка при загрузке задач",console.error("Ошибка при загрузке задач:",s))}finally{this.isLoading=!1}},selectTask(s){this.selectedTask=s,console.log("Выбрана задача:",s)},async loadTaskLogs(s){if(this.taskLogs[s]){console.log(`Логи для задачи ${s} уже загружены:`,this.taskLogs[s]);return}try{const a=await B(s);console.log(`Загруженные логи для задачи ${s}:`,a),this.taskLogs[s]=a}catch(a){console.error(`Ошибка при загрузке логов задачи ${s}:`,a),this.error=a.message||"Ошибка при загрузке логов"}}}}),le={key:1,class:"container mx-auto p-4"},oe={class:"text-2xl font-bold flex flex-col items-center"},ae={class:"font-normal text-gray-500 text-sm"},ne={key:0,class:"bg-white shadow-lg rounded-lg p-6"},re={key:1,class:"text-red-500"},ue={__name:"TaskDetailsView",setup(s){const a=A(),l=se(),u=a.params.id,n=m(()=>l.selectedTask),b=m(()=>l.taskLogs);m(()=>l.isLoading);const p=m(()=>l.error);return N(async()=>{try{l.tasks.length||await l.loadTasks();const g=l.tasks.find(t=>t.id===Number(u));g?(l.selectTask(g),await l.loadTaskLogs(u)):l.error=`Задача с ID ${u} не найдена`}catch(g){l.error=g.message||"Неизвестная ошибка при загрузке данных",console.error("Ошибка в onMounted:",g)}}),(g,t)=>{var x;const f=q("router-link");return L(l).isLoading?(c(),V(E,{key:0})):(c(),v("div",le,[e("h1",oe,[t[0]||(t[0]=r(" Детали задачи: ")),e("span",ae,o(((x=n.value)==null?void 0:x.name)||"Загрузка..."),1)]),n.value?(c(),v("div",ne,[e("p",null,[t[1]||(t[1]=e("strong",null,"ID:",-1)),r(" "+o(n.value.id),1)]),e("p",null,[t[2]||(t[2]=e("strong",null,"Название:",-1)),r(" "+o(n.value.name),1)]),e("p",null,[t[3]||(t[3]=e("strong",null,"URL:",-1)),r(" "+o(n.value.url),1)]),e("p",null,[t[4]||(t[4]=e("strong",null,"Содержимое:",-1)),r(" "+o(n.value.content),1)]),e("p",null,[t[5]||(t[5]=e("strong",null,"Интервал:",-1)),r(" "+o(n.value.interval),1)]),e("p",null,[t[6]||(t[6]=e("strong",null,"Частота:",-1)),r(" "+o(n.value.frequency||"Не указано"),1)]),e("p",null,[t[7]||(t[7]=e("strong",null,"Период:",-1)),r(" "+o(n.value.period||"Не указано"),1)]),e("p",null,[t[8]||(t[8]=e("strong",null,"Дата создания:",-1)),r(" "+o(n.value.created_at),1)]),t[9]||(t[9]=e("p",null,[e("strong",null,"Статус:"),r(),e("span",{class:"text-green-500"},"Ok")],-1)),T(te,{logs:b.value[L(u)]||[]},null,8,["logs"])])):(c(),v("div",re,[e("p",null,"Задача не найдена или произошла ошибка: "+o(p.value),1)])),T(f,{to:"/",class:"mt-4 text-blue-600 hover:underline flex items-center justify-center"},{default:j(()=>t[10]||(t[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"ml-2 h-4 w-4 svg-arrow-r rotate-180",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 5l7 7m0 0l-7 7m7-7H3"})],-1),r(" Назад к списку задач ")])),_:1})]))}}};export{ue as default};
