import{_ as M,r as _,c as g,o as d,a as u,b as e,w as P,v as z,n as y,F as $,d as T,e as b,t as n,f as N,g as A,h as I,i as q,u as j,j as E,k as C,l as F,m as R,p as U,I as H}from"./index-Bx6qt8R8.js";const K={key:0,class:"mt-4 w-full"},O={class:"title-group flex items-center justify-between pb-2 w-[92%] mx-auto"},G={class:"flex items-center"},J={class:"relative flex flex-col w-full h-full text-gray-700 bg-white shadow-md rounded-lg bg-clip-border overflow-hidden overflow-x-auto"},Q={class:"w-full text-left table-auto min-w-max"},W={class:"flex items-center"},X={class:"flex items-center"},Y={class:"p-4 py-5"},Z={class:"block font-semibold text-sm text-slate-800"},ee={class:"p-4 py-5"},te={class:"text-sm text-slate-500"},se={class:"p-4 py-5"},oe={class:"text-sm text-slate-500"},le={class:"flex justify-between items-center px-4 py-3 w-[90%] mx-auto"},ae={class:"text-sm text-slate-500"},ne={class:"flex space-x-1"},re=["disabled"],ie=["onClick"],de=["disabled"],ue={key:1,class:"mt-4 text-slate-500"},ce={__name:"TaskLogsTable",props:{logs:{type:Array,required:!0,default:()=>[]}},setup(o){const i=o,l=_(1),c=_(5),a=_(""),p=_("asc"),w=g(()=>{const x=[...i.logs];return a.value?x.sort((s,h)=>{let r=a.value==="id"?s.id:new Date(s.created_at).getTime(),k=a.value==="id"?h.id:new Date(h.created_at).getTime();return p.value==="asc"?r-k:k-r}):x}),v=g(()=>w.value.length),t=g(()=>Math.ceil(v.value/c.value)),f=g(()=>(l.value-1)*c.value),m=g(()=>Math.min(f.value+c.value,v.value)),D=g(()=>w.value.slice(f.value,m.value));function V(){l.value>1&&l.value--}function B(){l.value<t.value&&l.value++}function S(x){l.value=x}function L(x){a.value===x?p.value=p.value==="asc"?"desc":"asc":(a.value=x,p.value="asc"),l.value=1}return(x,s)=>{var h;return(h=o.logs)!=null&&h.length?(d(),u("div",K,[e("div",O,[s[5]||(s[5]=e("h2",{class:"text-xl font-semibold"},"Логи задачи",-1)),e("div",G,[s[4]||(s[4]=e("label",{class:"mr-2 text-sm text-slate-500"},"Логов на странице:",-1)),P(e("select",{"onUpdate:modelValue":s[0]||(s[0]=r=>c.value=r),class:"border rounded p-1 text-sm bg-white"},s[3]||(s[3]=[e("option",{value:5},"5",-1),e("option",{value:10},"10",-1)]),512),[[z,c.value]])])]),e("div",J,[e("table",Q,[e("thead",null,[e("tr",null,[e("th",{class:"p-4 border-b border-slate-200 bg-slate-50 cursor-pointer",onClick:s[1]||(s[1]=r=>L("id"))},[e("div",W,[s[7]||(s[7]=e("p",{class:"text-sm font-normal leading-none text-slate-500"},"ID",-1)),(d(),u("svg",{class:y(["table-sort ml-1",{"rotate-180":p.value==="desc"&&a.value==="id"}]),xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24"},s[6]||(s[6]=[e("path",{fill:"currentColor",d:"M9 3L5 6.99h3V14h2V6.99h3zm7 14.01V10h-2v7.01h-3L15 21l4-3.99z"},null,-1)]),2))])]),s[10]||(s[10]=e("th",{class:"p-4 border-b border-slate-200 bg-slate-50"},[e("p",{class:"text-sm font-normal leading-none text-slate-500"},"Сообщение")],-1)),e("th",{class:"p-4 border-b border-slate-200 bg-slate-50 cursor-pointer",onClick:s[2]||(s[2]=r=>L("created_at"))},[e("div",X,[s[9]||(s[9]=e("p",{class:"text-sm font-normal leading-none text-slate-500"},"Дата создания",-1)),(d(),u("svg",{class:y(["table-sort ml-1",{"rotate-180":p.value==="desc"&&a.value==="created_at"}]),xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24"},s[8]||(s[8]=[e("path",{fill:"currentColor",d:"M9 3L5 6.99h3V14h2V6.99h3zm7 14.01V10h-2v7.01h-3L15 21l4-3.99z"},null,-1)]),2))])])])]),e("tbody",null,[(d(!0),u($,null,T(D.value,r=>(d(),u("tr",{key:r.id,class:"hover:bg-slate-50 border-b border-slate-200"},[e("td",Y,[e("p",Z,n(r.id),1)]),e("td",ee,[e("p",te,n(r.message),1)]),e("td",se,[e("p",oe,n(new Date(r.created_at).toLocaleString()),1)])]))),128))])]),e("div",le,[e("div",ae,[s[11]||(s[11]=b(" Showing ")),e("b",null,n(f.value+1)+"-"+n(m.value),1),b(" of "+n(v.value),1)]),e("div",ne,[e("button",{onClick:V,disabled:l.value===1,class:"px-3 py-1 min-w-9 min-h-9 text-sm font-normal text-slate-500 bg-white border border-slate-200 rounded hover:bg-slate-50 hover:border-slate-400 transition duration-200 ease disabled:opacity-50"}," Prev ",8,re),(d(!0),u($,null,T(t.value,r=>(d(),u("button",{key:r,onClick:k=>S(r),class:y(["px-3 py-1 min-w-9 min-h-9 text-sm font-normal rounded transition duration-200 ease",l.value===r?"text-white bg-slate-800 border border-slate-800 hover:bg-slate-600 hover:border-slate-600":"text-slate-500 bg-white border border-slate-200 hover:bg-slate-50 hover:border-slate-400"])},n(r),11,ie))),128)),e("button",{onClick:B,disabled:l.value===t.value,class:"px-3 py-1 min-w-9 min-h-9 text-sm font-normal text-slate-500 bg-white border border-slate-200 rounded hover:bg-slate-50 hover:border-slate-400 transition duration-200 ease disabled:opacity-50"}," Next ",8,de)])])])])):(d(),u("p",ue,"Логов пока нет."))}}},ve=M(ce,[["__scopeId","data-v-6de7a851"]]),ge=N("taskStore",{state:()=>({tasks:[],taskLogs:{},selectedTask:null,isLoading:!1,error:null}),actions:{async loadTasks(){this.isLoading=!0,this.error=null;try{const o=await A();if(console.log("Данные от fetchTasks:",o),!Array.isArray(o))throw new Error("Сервер вернул данные, не являющиеся массивом");this.tasks=o.map(i=>({...i,created_at:i.created_at?new Date(i.created_at).toLocaleString():"Неизвестно"})),this.selectedTask=this.tasks.length>0?this.tasks[0]:null,console.log("Обработанные задачи:",this.tasks)}catch(o){o.message==="У вас нет задач. Вам нужно перейти в новую задачу и создать."?(console.warn(o.message),this.tasks=[]):(this.error=o.message||"Ошибка при загрузке задач",console.error("Ошибка при загрузке задач:",o))}finally{this.isLoading=!1}},selectTask(o){this.selectedTask=o,console.log("Выбрана задача:",o)},async loadTaskLogs(o){if(this.taskLogs[o]){console.log(`Логи для задачи ${o} уже загружены:`,this.taskLogs[o]);return}try{const i=await I(o);console.log(`Загруженные логи для задачи ${o}:`,i),this.taskLogs[o]=i}catch(i){console.error(`Ошибка при загрузке логов задачи ${o}:`,i),this.error=i.message||"Ошибка при загрузке логов"}}}}),pe={key:1,class:"container mx-auto pt-0 pb-6 px-2"},xe={class:"text-2xl font-bold flex flex-col items-center"},fe={class:"font-normal text-gray-500 text-sm"},me={key:0,class:"bg-white shadow-lg rounded-lg flex flex-col items-start overflow-hidden my-2"},he={class:"flex items-center justify-between gap-1 px-2"},be={class:"text-gray-700"},we={class:"flex items-center justify-between gap-1 px-2"},_e={class:"text-nowrap w-full truncate overflow-x-auto"},ke={class:"flex items-center justify-between gap-1 px-2"},ye={class:"text-nowrap w-full truncate overflow-x-auto"},Le={class:"flex items-center justify-between gap-1 px-2"},$e={class:"text-nowrap w-full truncate overflow-x-auto"},Te={class:"flex items-center justify-between gap-1 px-2"},je={class:"flex items-center justify-between gap-1 px-2"},Ce={class:"flex items-center justify-between gap-1 px-2"},De={class:"flex items-center justify-between gap-1 px-2"},Ve={class:"w-full"},Be={key:1,class:"text-red-500"},Me={__name:"TaskDetailsView",setup(o){const i=R(),l=ge(),c=i.params.id,a=g(()=>l.selectedTask),p=g(()=>l.taskLogs);g(()=>l.isLoading);const w=g(()=>l.error);return q(async()=>{try{l.tasks.length||await l.loadTasks();const v=l.tasks.find(t=>t.id===Number(c));v?(l.selectTask(v),await l.loadTaskLogs(c)):l.error=`Задача с ID ${c} не найдена`}catch(v){l.error=v.message||"Неизвестная ошибка при загрузке данных",console.error("Ошибка в onMounted:",v)}}),(v,t)=>{var m;const f=U("router-link");return j(l).isLoading?(d(),E(H,{key:0})):(d(),u("div",pe,[e("h1",xe,[t[0]||(t[0]=b(" Детали задачи: ")),e("span",fe,n(((m=a.value)==null?void 0:m.name)||"Загрузка..."),1)]),a.value?(d(),u("div",me,[e("p",he,[t[1]||(t[1]=e("strong",null,"ID:",-1)),e("span",be,n(a.value.id),1)]),e("p",we,[t[2]||(t[2]=e("strong",null,"Название:",-1)),e("span",_e,n(a.value.name),1)]),e("p",ke,[t[3]||(t[3]=e("strong",null,"URL:",-1)),e("span",ye,n(a.value.url),1)]),e("p",Le,[t[4]||(t[4]=e("strong",null,"Содержимое:",-1)),e("span",$e,n(a.value.content),1)]),e("p",Te,[t[5]||(t[5]=e("strong",null,"Интервал:",-1)),e("span",null,n(a.value.interval),1)]),e("p",je,[t[6]||(t[6]=e("strong",null,"Частота:",-1)),e("span",null,n(a.value.frequency||"Не указано"),1)]),e("p",Ce,[t[7]||(t[7]=e("strong",null,"Период:",-1)),e("span",null,n(a.value.period||"Не указано"),1)]),e("p",De,[t[8]||(t[8]=e("strong",null,"Дата создания:",-1)),e("span",null,n(a.value.created_at),1)]),t[9]||(t[9]=e("p",{class:"flex items-center justify-between gap-1 px-2"},[e("strong",null,"Статус:"),b(),e("span",{class:"text-green-500"},"Ok")],-1)),e("div",Ve,[C(ve,{logs:p.value[j(c)]||[]},null,8,["logs"])])])):(d(),u("div",Be,[e("p",null,"Задача не найдена или произошла ошибка: "+n(w.value),1)])),C(f,{to:"/",class:"mt-4 text-blue-600 hover:underline flex items-center justify-center"},{default:F(()=>t[10]||(t[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"ml-2 h-4 w-4 svg-arrow-r rotate-180",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 5l7 7m0 0l-7 7m7-7H3"})],-1),b(" Назад к списку задач ")])),_:1})]))}}};export{Me as default};
